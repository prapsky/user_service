
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>config: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">github.com/prapsky/user_service/common/config/config.go (0.0%)</option>
				
				<option value="file1">github.com/prapsky/user_service/common/logger/zerolog/zerolog.go (91.3%)</option>
				
				<option value="file2">github.com/prapsky/user_service/common/utils/hash.go (0.0%)</option>
				
				<option value="file3">github.com/prapsky/user_service/internal/repository/query_builder/user/insert.go (100.0%)</option>
				
				<option value="file4">github.com/prapsky/user_service/internal/repository/user.go (100.0%)</option>
				
				<option value="file5">github.com/prapsky/user_service/test/helpers/subreporter.go (66.7%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">no coverage</span>
				<span class="cov1">low coverage</span>
				<span class="cov2">*</span>
				<span class="cov3">*</span>
				<span class="cov4">*</span>
				<span class="cov5">*</span>
				<span class="cov6">*</span>
				<span class="cov7">*</span>
				<span class="cov8">*</span>
				<span class="cov9">*</span>
				<span class="cov10">high coverage</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package config

import (
        "github.com/joeshaw/envdecode"
        "github.com/joho/godotenv"
        "github.com/pkg/errors"
)

type Database struct {
        Host         string `env:"DATABASE_HOST,default=localhost"`
        Port         string `env:"DATABASE_PORT,default=5432"`
        Username     string `env:"DATABASE_USERNAME,required"`
        Password     string `env:"DATABASE_PASSWORD,required"`
        Name         string `env:"DATABASE_NAME,required"`
        SSLMode      string `env:"DATABASE_SSL_MODE,default=disable"`
        MaxOpenConns int    `env:"DATABASE_MAX_OPEN_CONNS,default=5"`
        MaxIdleConns int    `env:"DATABASE_MAX_IDLE_CONNS,default=1"`
}

type Auth struct {
        PrivateKey string `env:"PRIVATE_KEY,required"`
        PublicKey  string `env:"PUBLIC_KEY,required"`
}

type Config struct {
        HashIDSalt      string `env:"HASHID_SALT"`
        HashIDMinLength int    `env:"HASHID_MIN_LENGTH"`
        Port            string `env:"PORT,default=6666"`
        Auth            Auth
        Database        Database
}

func NewConfig(env string) (*Config, error) <span class="cov0" title="0">{
        _ = godotenv.Load(env)

        var config Config
        if err := envdecode.Decode(&amp;config); err != nil </span><span class="cov0" title="0">{
                return nil, errors.Wrap(err, "[NewConfig] error decoding env")
        }</span>

        <span class="cov0" title="0">return &amp;config, nil</span>
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package zerolog

import (
        "context"
        "os"

        "github.com/rs/zerolog"
)

const (
        ContextKeyRequestId = "requestID"
        LogKeyRequestId     = "request_id"
        ContextKeyEventId   = "eventID"
        LogKeyEventId       = "event_id"
)

type Zerolog struct {
        logger zerolog.Logger
}

func NewZeroLog() Zerolog <span class="cov10" title="8">{
        return Zerolog{
                logger: zerolog.New(os.Stderr).With().Timestamp().Logger(),
        }
}</span>

func (z Zerolog) Error(err error, message string) <span class="cov0" title="0">{
        z.logger.Error().Err(err).Msg(message)
}</span>

func (z Zerolog) ErrorWithContext(ctx context.Context, err error, message string) <span class="cov1" title="1">{
        logger := z.withContext(ctx).logger
        logger.Error().Err(err).Msg(message)
}</span>

func (z Zerolog) ErrorfWithContext(ctx context.Context, err error, format string, v ...interface{}) <span class="cov1" title="1">{
        logger := z.withContext(ctx).logger
        logger.Error().Err(err).Msgf(format, v...)
}</span>

func (z Zerolog) WarnfWithContext(ctx context.Context, err error, format string, v ...interface{}) <span class="cov1" title="1">{
        logger := z.withContext(ctx).logger
        logger.Warn().Err(err).Msgf(format, v...)
}</span>

func (z Zerolog) InfofWithContext(ctx context.Context, format string, v ...interface{}) <span class="cov1" title="1">{
        logger := z.withContext(ctx).logger
        logger.Info().Msgf(format, v...)
}</span>

func (z Zerolog) Info(message string) <span class="cov5" title="3">{
        z.logger.Info().Msg(message)
}</span>

func (z Zerolog) Infof(format string, v ...interface{}) <span class="cov0" title="0">{
        z.logger.Info().Msgf(format, v...)
}</span>

func (z Zerolog) WithHandlerName(name string) Zerolog <span class="cov1" title="1">{
        z.logger = z.logger.With().Str("handlerName", name).Logger()
        return z
}</span>

func (z Zerolog) WithServiceName(name string) Zerolog <span class="cov1" title="1">{
        z.logger = z.logger.With().Str("serviceName", name).Logger()
        return z
}</span>

func (z Zerolog) WithRepositoryName(name string) Zerolog <span class="cov1" title="1">{
        z.logger = z.logger.With().Str("repositoryName", name).Logger()
        return z
}</span>

func (z Zerolog) withContext(ctx context.Context) Zerolog <span class="cov7" title="4">{
        if value, ok := ctx.Value(ContextKeyRequestId).(string); ok </span><span class="cov7" title="4">{
                z.logger = z.logger.With().Str(LogKeyRequestId, value).Logger()
        }</span>

        <span class="cov7" title="4">if value, ok := ctx.Value(ContextKeyEventId).(string); ok </span><span class="cov1" title="1">{
                z.logger = z.logger.With().Str(LogKeyEventId, value).Logger()
        }</span>

        <span class="cov7" title="4">return z</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package utils

import (
        "golang.org/x/crypto/bcrypt"
)

func HashPassword(password string) (string, error) <span class="cov0" title="0">{
        hashed, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)
        return string(hashed), err
}</span>
</pre>
		
		<pre class="file" id="file3" style="display: none">package user

import (
        "github.com/Masterminds/squirrel"
        "github.com/prapsky/user_service/entity"
        consts "github.com/prapsky/user_service/internal/repository/consts/user"
        query_bulder "github.com/prapsky/user_service/internal/repository/query_builder"
)

type InsertQueryBuilder struct {
        user *entity.User
}

func NewInsertQueryBuilder(user *entity.User) InsertQueryBuilder <span class="cov8" title="1">{
        return InsertQueryBuilder{
                user: user,
        }
}</span>

func (qb InsertQueryBuilder) Build() query_bulder.Result <span class="cov8" title="1">{
        sq := squirrel.StatementBuilder.PlaceholderFormat(squirrel.Dollar)

        builder := sq.Insert(consts.TableName).
                Columns(consts.NameColumn, consts.PhoneNumberColumn,
                        consts.UsernameColumn, consts.PasswordHashColumn,
                        consts.CreatedAtColumn, consts.UpdatedAtColumn).
                Values(qb.user.Name, qb.user.PhoneNumber,
                        qb.user.Username, qb.user.Password,
                        qb.user.CreatedAt, qb.user.UpdatedAt).
                SuffixExpr(squirrel.Expr("RETURNING id"))

        sql, params, _ := builder.ToSql()
        return query_bulder.Result{Syntax: sql, Params: params}
}</span>
</pre>
		
		<pre class="file" id="file4" style="display: none">package repository

import (
        "context"
        "database/sql"

        "github.com/prapsky/user_service/common/logger/zerolog"
        "github.com/prapsky/user_service/entity"
        queryBuilder "github.com/prapsky/user_service/internal/repository/query_builder/user"
)

type User struct {
        db  *sql.DB
        log zerolog.Zerolog
}

func NewUser(db *sql.DB, log zerolog.Zerolog) *User <span class="cov10" title="2">{
        return &amp;User{
                db:  db,
                log: log.WithRepositoryName("User"),
        }
}</span>

func (r *User) Insert(ctx context.Context, user *entity.User) (uint64, error) <span class="cov10" title="2">{
        query := queryBuilder.NewInsertQueryBuilder(user).Build()

        userID := uint64(0)
        if err := r.db.QueryRowContext(ctx, query.Syntax, query.Params...).Scan(&amp;userID); err != nil </span><span class="cov1" title="1">{
                r.log.ErrorWithContext(ctx, err, "error exec insert query")
                return 0, err
        }</span>

        <span class="cov1" title="1">return userID, nil</span>
}
</pre>
		
		<pre class="file" id="file5" style="display: none">package helpers

import (
        "github.com/golang/mock/gomock"
)

// SubReporter implements the same interface required by gomock
type SubReporter struct {
        t []gomock.TestReporter
}

// NewSubReporter creates instance of SubReporter
func NewSubReporter(t gomock.TestReporter) *SubReporter <span class="cov10" title="2">{
        return &amp;SubReporter{t: []gomock.TestReporter{t}}
}</span>

// Add is responsible for add subtest
func (s *SubReporter) Add(t gomock.TestReporter) func() <span class="cov1" title="1">{
        s.t = append(s.t, t)
        return func() </span><span class="cov1" title="1">{
                s.t = s.t[:len(s.t)-1]
        }</span>
}

// Errorf returns error of SubReporter
func (s *SubReporter) Errorf(format string, args ...interface{}) <span class="cov0" title="0">{
        s.t[len(s.t)-1].Errorf(format, args...)
}</span>

// Fatalf returns fatal of SubReporter
func (s *SubReporter) Fatalf(format string, args ...interface{}) <span class="cov0" title="0">{
        s.t[len(s.t)-1].Fatalf(format, args...)
}</span>
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
